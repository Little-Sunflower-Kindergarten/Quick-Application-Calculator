'use strict';

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _info = require('../../common/info');

var info = _interopRequireWildcard(_info);

var _uxFileLoader = require('./ux-file-loader');

var _uxFileLoader2 = _interopRequireDefault(_uxFileLoader);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * ux文件解析总入口
 * @param source
 */
function loader(source) {
  var callback = this.async();
  this.cacheable && this.cacheable();

  var resourcePath = this.resourcePath; // 当前文件绝对路径

  var _path$parse = _path2.default.parse(resourcePath),
      ext = _path$parse.ext;

  if (info.name.extList.indexOf(ext) !== -1) {
    (0, _uxFileLoader2.default)(this, source).then(function (result) {
      callback(null, result);
    }).catch(function (e) {
      callback(e, '');
    });
  } else {
    this.emitError('\u672A\u77E5\u6587\u4EF6\u683C\u5F0F\uFF1A' + ext);
  }
} /*
   * Copyright (C) 2017, hapjs.org. All rights reserved.
   */

module.exports = loader;