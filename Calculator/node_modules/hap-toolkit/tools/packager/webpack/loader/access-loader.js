/*
 * Copyright (C) 2017, hapjs.org. All rights reserved.
 */

'use strict';

/**
 * 只有页面组件才需要, 子组件不需要
 * @param source
 * @return {string|*}
 */

module.exports = function (source) {
  this.cacheable && this.cacheable();

  var contentAccess = '\n\n  const moduleOwn = exports.default || module.exports\n  const accessors = [\'public\', \'protected\', \'private\']\n\n  if (moduleOwn.data && accessors.some(function (acc) { return moduleOwn[acc] })) {\n    throw new Error(\'\u9875\u9762VM\u5BF9\u8C61\u4E2D\u7684\u5C5E\u6027data\u4E0D\u53EF\u4E0E"\' + accessors.join(\',\') + \'"\u540C\u65F6\u5B58\u5728\uFF0C\u8BF7\u4F7F\u7528private\u66FF\u6362data\u540D\u79F0\')\n  }\n  else if (!moduleOwn.data) {\n    moduleOwn.data = {}\n    moduleOwn._descriptor = {}\n    accessors.forEach(function (acc) {\n      const accType = typeof moduleOwn[acc]\n      if (accType === \'object\') {\n        moduleOwn.data = Object.assign(moduleOwn.data, moduleOwn[acc])\n        for (const name in moduleOwn[acc]) {\n          moduleOwn._descriptor[name] = { access: acc }\n        }\n      }\n      else if (accType === \'function\') {\n        console.warn(\'\u9875\u9762VM\u5BF9\u8C61\u4E2D\u7684\u5C5E\u6027\' + acc + \'\u7684\u503C\u4E0D\u80FD\u662F\u51FD\u6570\uFF0C\u8BF7\u4F7F\u7528\u5BF9\u8C61\')\n      }\n    })\n  }\n';
  source += contentAccess;

  return source;
};