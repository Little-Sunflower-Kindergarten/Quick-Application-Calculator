'use strict';

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _child_process = require('child_process');

var _child_process2 = _interopRequireDefault(_child_process);

var _utils = require('../../common/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function NotifyPlugin(options) {
  this.options = options;
} /*
   * Copyright (C) 2017, hapjs.org. All rights reserved.
   */

NotifyPlugin.prototype.apply = function (compiler) {
  compiler.plugin('done', function (stats) {
    // 发送通知
    var serverPath = _path2.default.join(__dirname, '../../..', 'server');
    var cmdStr = 'cd ' + serverPath + ' && node ./command/notify.js';
    _child_process2.default.exec(cmdStr, function (err, stdout, stderr) {
      _utils.colorconsole.log('### App Loader ### 请求手机自动刷新');
      err && _utils.colorconsole.log(err.message);
      stdout && _utils.colorconsole.log(stdout);
      stderr && _utils.colorconsole.log(stderr);
    });
  });
};

module.exports = NotifyPlugin;