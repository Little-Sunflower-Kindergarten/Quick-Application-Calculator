/*
 * Copyright (C) 2017, hapjs.org. All rights reserved.
 */

'use strict';

var _compiler = require('../../compiler');

var _utils = require('../../common/utils');

module.exports = function (source) {
  var _this = this;

  this.cacheable && this.cacheable();

  var callback = this.async();
  (0, _compiler.parseTemplate)({ code: source, filePath: this.resourcePath }).then(function (_ref) {
    var parsed = _ref.parsed,
        log = _ref.log;

    if (log && log.length) {
      (0, _utils.logWarn)(_this, log);
    }
    callback(null, parsed);
  }).catch(function (e) {
    callback(e, '');
  });
};